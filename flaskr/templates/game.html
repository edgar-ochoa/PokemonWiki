{% extends "main.html" %}

{% block page_name %}
Who's that pokemon?
{% endblock %}

{% block content %}
<meta id="user_points" data-name="user_points" data-other="{{user['points']}}">
<meta id="correct_answer" data-name="correct_answer" data-other="{{data['name']['english']}}">
<div  class="game_background" >

    <div class="stats">
        <span id="score" class="score">score: {{user['points']}} </span>
        <span id="rank" class="rank"> rank: {{user['rank']}} </span>
    </div>
    <div>
        <img id="pokemon_image" src="data:image/jpg;base64,{{image}}" class="pokemon_image">
        <svg width="400px" height="100%" viewBox="0 0 400 400">
            <rect width="600" height="600"  class="star_svg1">

            </rect>
                <path d="M200,7,205.18015042982137,73.10568948323797,215.73129172458323,7.642191578620697,
                215.50597824301832,73.95015018363948,231.35789429821972,9.564492635481258,225.7286163293143,75.63345183780751,
                246.77581525899,12.754110574205555,235.78003471886157,78.14439235095884,261.88245088667793,17.18981901366135,
                245.59334288064503,81.46626182825442,276.57726901360076,22.84209904602443,255.10323486792987,
                85.57695377639276,290.7624780495982,29.67333568024,264.24642391856247,90.44911221867545,304.3436777689303,
                37.63806816358206,272.9620636179308,96.05031374451863,317.2304875282053,46.683292515462284,281.19215282181506,
                102.34328328190102,329.33714773464897,56.74881426017589,288.88192164443234,109.28614215681824,340.5830905620459,
                67.76764901120606,295.9801959429908,116.83268678894879,350.8934761163298,79.66646824126441,302.43973787316634,
                124.93269616885807,360.19969048273055,92.36608727154193,308.21756024916294,133.53226607053028,368.4398023400572,
                105.78199223268173,313.2752126163421,142.5741677750989,375.55897510342203,119.82490249063592,317.57903713265404,
                151.99822891852887,381.5098318526656,134.40136479455498,321.1003925560238,161.74173392877123,386.25277061794395,
                149.41437519275328,323.8158448470916,171.73984138754807,389.7562279243041,164.7640245780032,325.70732311887843,
                181.9260155392928,391.99688884140176,180.34816356615974,326.76223989555757,192.23246907562597,392.95984214051686,
                196.06308228345875,326.9735748800292,202.59061424870848,392.63867952631983,211.80420053861562,326.3399216728395,
                212.93151931138706,391.03553828302006,227.466763786744,324.86549713153687,223.1863672465989,388.16108705109195,
                242.94654025356863,322.5601133081808,233.28691373326595,384.034454829233,258.14051458068616,319.43911215175405,
                243.1659413009923,378.6831036740333,272.947573375779,315.52326341002384,252.75770665123957,372.1426459445199,
                287.26917810555835,310.83862641029674,261.9983781681317,364.4566073077831,301.0100208534461,305.41637663889526,270.8264607073273,
                355.6761370828433,314.07865857803455,299.2925982734398,279.18320483605913,345.85966785037186,326.38812165144,292.5080440486002,
                287.0129978009162,335.0725265935074,337.8564926278274,285.1078640533701,294.26373362154226,323.38649995756145,348.4074513904969,
                277.141305264674,300.8871598473383,310.87935652173746,357.9707830496685,268.66138381686096,306.83919866956,297.6343292620674,
                366.48284521098924,259.7245321880776,312.0802402518628,283.73956164968877,373.88699150516686,250.39022365143677,
                316.5754063272274,269.2875210705866,380.13394856021176,240.7205764901974,320.2947823070726,254.37438347039594,
                385.182143907598,230.77994061083797,323.2136163579062,239.0993933193517,388.9979826401823,220.63446930504614,
                325.3124841206937,223.5642031567129,391.55607098076837,210.35167901047703,326.57741797676255,207.8721971098861,
                392.8393852735045,200,327,192.12780289011403,392.8393852735045,189.648320989523,326.57741797676255,176.43579684328716,
                391.55607098076837,179.3655306949539,325.3124841206937,160.90060668064842,388.9979826401823,169.22005938916203,
                323.2136163579062,145.62561652960412,385.182143907598,159.2794235098026,320.2947823070726,130.71247892941358,
                380.1339485602118,149.60977634856323,316.5754063272274,116.26043835031138,373.886991505167,140.27546781192243,
                312.0802402518628,102.3656707379327,366.48284521098935,131.33861618313915,306.83919866956006,89.12064347826264,
                357.97078304966857,122.85869473532611,300.88715984733835,76.61350004243862,348.40745139049693,114.89213594662996,
                294.2637336215423,64.9274734064926,337.8564926278274,107.49195595139983,287.0129978009162,54.140332149628165,
                326.38812165144003,100.70740172656022,279.1832048360592,44.3238629171567,314.0786585780346,94.5836233611048,
                270.8264607073274,35.543392692216884,301.0100208534461,89.16137358970329,261.99837816813175,27.857354055480073,
                287.26917810555835,84.47673658997618,252.75770665123963,21.316896325966695,272.94757337577903,80.56088784824597,
                243.16594130099242,15.965545170766973,258.1405145806863,77.43988669181925,233.28691373326603,11.838912948908074,
                242.9465402535688,75.13450286846312,223.18636724659893,8.964461716979997,227.46676378674402,73.6600783271605,
                212.93151931138715,7.361320473680195,211.80420053861573,73.02642511997078,202.59061424870848,7.040157859483145,
                196.06308228345884,73.2377601044424,192.232469075626,8.003111158598216,180.3481635661599,74.29267688112154,
                181.92601553929282,10.243772075695915,164.76402457800322,76.18415515290839,171.73984138754815,13.747229382055963,
                149.41437519275337,78.8996074439762,161.74173392877125,18.490168147334344,134.40136479455504,82.42096286734592,
                151.99822891852892,24.441024896577858,119.82490249063615,86.72478738365787,142.57416777509894,31.56019765994273,
                105.78199223268176,91.78243975083701,133.5322660705303,39.800309517269454,92.36608727154189,97.56026212683368,
                124.9326961688581,49.106523883670235,79.66646824126445,104.01980405700915,116.83268678894885,59.41690943795405,
                67.76764901120609,111.11807835556766,109.28614215681824,70.66285226535095,56.748814260175976,118.80784717818493,
                102.34328328190105,82.76951247179474,46.683292515462256,127.03793638206913,96.05031374451866,95.65632223106954,
                37.63806816358212,135.75357608143742,90.44911221867552,109.23752195040169,29.673335680240058,144.8967651320701,
                85.57695377639278,123.42273098639909,22.842099046024487,154.40665711935486,81.46626182825446,138.11754911332196,
                17.189819013661378,164.21996528113843,78.14439235095884,153.22418474100994,12.754110574205583,174.27138367068562,
                75.63345183780753,168.64210570178022,9.564492635481258,184.4940217569816,73.95015018363948,184.26870827541677,
                7.642191578620697,194.81984957017855,73.10568948323797Z" 
                fill="#41aaba" stroke="rgba(255,0,0,0.2" stroke-width="2">
                </path>
        </svg>
        <!--
                  <svg width="400px" height="400px" viewBox="0 0 400 400"><rect width="600" height="600" fill="none" class="star_svg2"></rect><path d="M200,7,207.5867629906966,84.248364904322,225.19155509847,8.651141754854592,222.6304773538709,86.22890747322526,249.9520757047865,13.576315526209811,237.28697797516674,90.15610497856774,273.85790244646233,21.691250225321653,251.30548806540415,95.96276198220815,296.5,32.857097069603356,264.4461470302739,103.54952497290475,317.4909557986831,46.882805323791615,276.484114551608,112.78658233243864,336.4716087690037,63.528391230996334,287.2134176675614,123.51588544839201,353.1171946762084,82.50904420131691,296.45047502709525,135.55385296972617,367.14290293039664,103.50000000000001,304.0372380177918,148.69451193459585,378.30874977467835,126.14209755353767,309.8438950214323,162.71302202483326,386.4236844737902,150.0479242952135,313.77109252677474,177.36952264612913,391.3488582451454,174.80844490153004,315.751635095678,192.4132370093034,393,200,315.751635095678,207.5867629906966,391.3488582451454,225.19155509846996,313.77109252677474,222.63047735387087,386.4236844737902,249.9520757047865,309.8438950214323,237.28697797516674,378.30874977467835,273.85790244646233,304.0372380177918,251.30548806540415,367.14290293039664,296.5,296.45047502709525,264.44614703027383,353.1171946762084,317.4909557986831,287.2134176675614,276.484114551608,336.4716087690037,336.47160876900364,276.484114551608,287.2134176675614,317.4909557986831,353.1171946762084,264.4461470302739,296.45047502709525,296.5,367.14290293039664,251.30548806540415,304.0372380177919,273.85790244646233,378.30874977467835,237.28697797516674,309.8438950214323,249.9520757047865,386.4236844737902,222.6304773538709,313.77109252677474,225.19155509847,391.3488582451454,207.5867629906966,315.751635095678,200,393,192.41323700930343,315.751635095678,174.8084449015301,391.34885824514544,177.36952264612916,313.77109252677474,150.04792429521348,386.4236844737902,162.71302202483326,309.8438950214323,126.14209755353768,378.30874977467835,148.69451193459588,304.0372380177919,103.50000000000004,367.14290293039664,135.55385296972614,296.45047502709525,82.50904420131691,353.1171946762084,123.51588544839201,287.2134176675614,63.528391230996334,336.4716087690037,112.7865823324386,276.48411455160795,46.88280532379159,317.49095579868305,103.54952497290473,264.44614703027383,32.85709706960333,296.5,95.96276198220816,251.30548806540415,21.691250225321653,273.85790244646233,90.15610497856775,237.28697797516676,13.57631552620984,249.95207570478655,86.22890747322526,222.63047735387087,8.651141754854592,225.19155509846996,84.248364904322,207.5867629906966,7,200.00000000000003,84.248364904322,192.41323700930343,8.651141754854564,174.8084449015301,86.22890747322526,177.36952264612916,13.576315526209783,150.04792429521356,90.15610497856773,162.71302202483332,21.691250225321625,126.14209755353778,95.96276198220816,148.69451193459582,32.857097069603356,103.49999999999997,103.54952497290475,135.55385296972614,46.882805323791615,82.50904420131691,112.78658233243861,123.51588544839201,63.528391230996306,63.528391230996334,123.51588544839198,112.78658233243864,82.50904420131687,46.882805323791644,135.55385296972605,103.5495249729048,103.49999999999991,32.857097069603384,148.69451193459585,95.96276198220816,126.14209755353772,21.691250225321625,162.71302202483324,90.15610497856775,150.04792429521353,13.576315526209811,177.36952264612907,86.22890747322528,174.80844490153004,8.651141754854592,192.41323700930334,84.248364904322Z" 
            fill="#cfebe7" stroke="rgba(255,0,0,0.2" stroke-width="2"></path></svg>
    

        -->
      

    
        <!--
        <p>{{data['name']['english']}}</p>
        <p> player: {{current_user.username}} </p>
        -->

        
        

    </div>

    <div>
        <form id="game_form" class="game_form" method="POST" action="/game">
            <input type="hidden" id="username" name="username" value="{{current_user.username}}">
            <input type="hidden" id="data" name="data" value="{{data}}">
            <input type="hidden" id="correct" name="correct" value="{{answer}}">
            <input type="hidden" id="points" name="points" value="{{user['points']}}">
            <input type="hidden" id="rank" name="rank" value="{{user['rank']}}">
            <input type="hidden" id="user_name" name="user_name" value="{{user['name']}}">
            <input type="text" class="user_guess" id="user_guess" name="user_guess" value="Who's that pokemon?" onfocus="this.value=''">
            <input type="image" src="data:image/jpg;base64,{{pokeball}}" alt="Submit" id="pokeball" class="pokeball">

        </form>
    </div>
    <div id="skip" class="skip">
        Skip        
    </div>

</div>
<script>
   /* var form = document.getElementById("game_form");
    form.addEventListener("submit", e=> {
        const formData = new FormData();
        var user_points = $('#user_points').data();
        formData.append("score","66666");
        console.log(formData.entries());

        const xhr = new XMLHttpRequest();
        xhr.open('POST','/game',true);
        xhr.send(formData);
    });

 */
    var attempts = 0;
    var pokemon_image = document.getElementById('pokemon_image');
    var guess = document.getElementById('user_guess');
    var skip = document.getElementById('skip');
    var form = document.getElementById('game_form');
    var correct = document.getElementById('correct');
    skip.onclick = function () {
        form.submit();
    }
    form.addEventListener("submit", function(e) {
        e.preventDefault()
        //JSONparser p = new JSONparser();
        //pokemon_image = document.getElementById("pokemon_image") //.css({brightness: 100%},"slow")
        var best_guess = form['user_guess'].value;
        var correct_string = form['data'].value;

        console.log(best_guess);
        console.log(correct.value.toUpperCase());

        if( correct.value.toUpperCase() == best_guess.toUpperCase() ){
            pokemon_image.classList.add('reveal');
        }else{
            attempts = attempts + 1;
            console.log(attempts);
            if(best_guess.value == "") {
                guess.innerHTML="Who's that pokemon?";
            }
            guess.classList.add('shake');
            guess.addEventListener("animationend", () => {
                guess.classList.remove('shake');
            });
  
        }
        if( attempts >= 1 ) {
            skip.classList.add('reveal');
        }

        pokemon_image.addEventListener("animationend", () => {
            form.submit();
        });
       
    })
    
 </script>

{% endblock %}